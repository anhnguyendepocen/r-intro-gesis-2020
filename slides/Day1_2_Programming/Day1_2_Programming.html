<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introduction to R for Data Analysis</title>
    <meta charset="utf-8" />
    <meta name="author" content="Johannes Breuer Stefan Jünger" />
    <meta name="date" content="2020-08-03" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/viz/viz.js"></script>
    <link href="libs/DiagrammeR-styles/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding/grViz.js"></script>
    <link rel="stylesheet" href="..\workshop.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Introduction to R for Data Analysis
## Programming in R
### Johannes Breuer<br />Stefan Jünger
### 2020-08-03

---

layout: true



&lt;div class="my-footer"&gt;
  &lt;div style="float: left;"&gt;&lt;span&gt;Johannes Breuer, Stefan Jünger&lt;/span&gt;&lt;/div&gt;
  &lt;div style="float: right;"&gt;&lt;span&gt;GESIS, Cologne, Germany, 2020-08-03&lt;/span&gt;&lt;/div&gt;
  &lt;div style="text-align: center;"&gt;&lt;span&gt;Programming in R&lt;/span&gt;&lt;/div&gt;
&lt;/div&gt;


&lt;style type="text/css"&gt;
# .remark-slide-content {
#   font-size: 28px;
#   padding: 20px 80px 20px 80px;
# }
# .remark-code, .remark-inline-code {
#   background: #f0f0f0;
# }
# .remark-code {
#   font-size: 24px;
# }
# .huge .remark-code { /*Change made here*/
#   font-size: 200% !important;
# }
.tinyish .remark-code { /*Change made here*/
  font-size: 70% !important;
}
&lt;/style&gt;

---

## Content of this programming session 
.pull-left[
**What you will learn**
- How to write loops
- How to write functions
- Casual comparison of Base R vs. Tidyverse programming
]

.pull-right[
**What you won't learn**
- Full-blown programming introduction
- Lengthy comparison to other languages
- Exhausting review of data types, methods, and classes
- Debugging
]

---

## What is programming?
So, the all-knowing Wikipedia says programming involves:
- analysis
- generating algorithms
- profiling algorithms accuracy and resource consumption
- **implementation of algorithms in a chosen programming language**

.footnote[https://en.wikipedia.org/wiki/Computer_programming]

---

## R is/as a programming language
Originally, R was created for statistical analysis
- R package designers are no computer scientists
- Because of that, R is known as not being as efficient as other languages
  - Judge by yourself
  - It also depends on the **programming**


Many ways to interact with the language is similar to mathematical notation
- Don't get scared of that, yet this is why we deal with vectors, matrices, and so forth.

---

## It boils down to...
.pull-left[
**Where your data are stored**
- Vectors
- Matrices
- Data frames / Tibbles
- Lists
]

.pull-right[
**How your data are stored**
- 'Numbers' (Integers &amp; Doubles)
- Character Strings
- Logical
- Factors
- ...
- There's more, e.g., expressions, but let's leave it that way
]

.footnote[https://www.stat.berkeley.edu/~nolan/stat133/Fall05/lectures/DataTypes4.pdf]

---

## Vectors
Vectors are built by enclosing your content with `c()` ("c" for "combine")


```r
numeric_vector   &lt;- c(1, 2, 3, 4)
character_vector &lt;- c("a", "b", "c", "d")

numeric_vector
```

```
## [1] 1 2 3 4
```

```r
character_vector
```

```
## [1] "a" "b" "c" "d"
```

---

## Matrices
Matrices are the basic rectangular data format in R.


```r
fancy_matrix &lt;- matrix(1:16, nrow = 4)

fancy_matrix
```

```
##      [,1] [,2] [,3] [,4]
## [1,]    1    5    9   13
## [2,]    2    6   10   14
## [3,]    3    7   11   15
## [4,]    4    8   12   16
```

You cannot store multiple data types, such as strings or numeric types. Otherwise your data is getting coerced in a common type.
- In fact, this is something that happens already in vectors

---

## Matrices and subscripts (as in mathematical annotation)
Identify rows, columns or elements using subscripts. 


```r
fancy_matrix[,4] # 4th column of matrix
fancy_matrix[3,] # 3rd row of matrix
fancy_matrix[2:4,1:3] # rows 2,3,4 of columns 1,2,3 
```

If you plan to participate at the mathematical tools workshop in this summer school, you will learn how to do some calculations, such as matrix multiplications:


```r
fancy_matrix[2:4, 1:3] %*% fancy_matrix[1:3, 2:4]
```

```
##      [,1] [,2] [,3]
## [1,]  116  188  260
## [2,]  134  218  302
## [3,]  152  248  344
```

---

## Data frames
While matrices are used, e.g.,--\*drumroll\*-- for matrix operations, data frames
resembles more what we know of data we usually use. We can build data.frames by 
hand as here:


```r
library(randomNames) # a name generator package

fancy_data &lt;-
  data.frame(
    who = randomNames(n = 10, which.names = "first"),
    age = sample(14:49, 10, replace = TRUE), # you see what we are doing here?                
    was_milk_available = sample(c(TRUE, FALSE), 10, replace = TRUE) # and here?
  )
```

---


```r
fancy_data
```

```
##          who age was_milk_available
## 1       Zack  29              FALSE
## 2     Ariyya  34              FALSE
## 3    Brandon  23               TRUE
## 4  Alexander  18              FALSE
## 5     Kelsey  16              FALSE
## 6   Madeline  19               TRUE
## 7    Bradley  47              FALSE
## 8      Susan  15               TRUE
## 9     Kaivon  44               TRUE
## 10    Arthur  16               TRUE
```

---

## tibbles
data.frames tend to be pretty large, and printing them on your screen can get
difficult. As part of the Tidyverse, tibbles facilitate printing (and adding
more metadata to the columns of a data.frame). Instead of using `data.frame()`
for our data creation we could have been using `tibble()`. Or we convert an 
existing data.frame, which looks like that:


```r
library(tibble)
as_tibble(fancy_data)
```

```
## # A tibble: 10 x 3
##    who         age was_milk_available
##    &lt;chr&gt;     &lt;int&gt; &lt;lgl&gt;             
##  1 Zack         29 FALSE             
##  2 Ariyya       34 FALSE             
##  3 Brandon      23 TRUE              
##  4 Alexander    18 FALSE             
##  5 Kelsey       16 FALSE             
##  6 Madeline     19 TRUE              
##  7 Bradley      47 FALSE             
##  8 Susan        15 TRUE              
##  9 Kaivon       44 TRUE              
## 10 Arthur       16 TRUE
```

---

## Object orientation in R
R is an object orientated language
- That's more than just assigning, e.g., a number to an object and working on it like 


```r
object &lt;- 2
object + 3
```

```
## [1] 5
```

Object orientation also includes, e.g., emphasis on attributes of data. They 
have a structure and belong to a class:


```r
str(character_vector)
```

```
##  chr [1:4] "a" "b" "c" "d"
```

```r
class(character_vector)
```

```
## [1] "character"
```
  
But we'll leave it at that for now

---

## Functional Programming: In R, everything's a function (more or less)
So you might already be familiar with using functions in R (at least we have used
them heavily in the preceding slides). Functions are applied as shown here:


```r
fancy_function(data)
```

They can be nested, for example:


```r
log(sum(c(1, 2, 3)))
```

```
## [1] 1.791759
```

Later on, we will learn about pipes `%&gt;%` which help to navigate some issues 
with too many levels of nesting

---

## Defining your own function is straightforward
First, let's create a simple function which is pasting together some strings
and numbers.


```r
milk_bought &lt;- function (n_bottles) {
  
  # define our string
  our_string &lt;- 
    paste0("I have bought ",  n_bottles, " bottles of milk")
  
  # we need to print it
  our_string
}
```

Now, we can simply apply it to some dataa s in any other R function


```r
milk_bought(n_bottles = 20)
```

```
## [1] "I have bought 20 bottles of milk"
```

---

## Loops
We can use loops to iterate through data, applying a function

- if else
- for
- while
- apply family
- tidyverse implementation: `purrr::`


---
class: middle
background-image: url("https://github.com/yihui/xaringan/releases/download/v0.0.2/karl-moustache.jpg")

There's this silly programmer joke:

.large[
&gt; A room mate asked his friend who is a programmer to go shopping: "hey, can you buy a bottle of milk? Oh and if they have eggs, buy 12". So the programmer went shopping. When he got back, he bought 12 bottles of milk and his room mate asked "why the heck did you bought 12 bottle of milk?!" The programmer responded: "they have eggs" (formatting done by me)
]

.footnote[https://www.reddit.com/r/Jokes/comments/5qyxar/a_programmer_goes_shopping/]

---

## Architecture of the joke

<div id="htmlwidget-eea9ec7fa0ce3c96d52f" style="width:504px;height:504px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-eea9ec7fa0ce3c96d52f">{"x":{"diagram":"digraph flowchart {\n      # node definitions with substituted label text\n      node [fontname = Helvetica, shape = rectangle]        \n      tab1 [label = \"Room mate is asked to buy a bottle of milk\"]\n      tab2 [label = \"Do they have eggs?\"]\n      tab3 [label = \"Yes\", shape = diamond]\n      tab4 [label = \"No\", shape = diamond]\n      tab5 [label = \"Room mate is buying 12 bottles of milk\"]\n      tab6 [label = \"Room mate is buying 1 bottle of milk\"]\n\n      # edge definitions with the node IDs\n      tab1 -> tab2;\n      tab2 -> tab3;\n      tab2 -> tab4;\n      tab3 -> tab5;\n      tab4 -> tab6;\n      }","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

---

## if else architecture in R
Using if else statements in R requires at least 3 steps:
1. Starting the loop with `if()`
2. Add the condition to be tested in the brackets of `if(condition)`
3. Write a function or procedure on data in the curly brackets of `if(condition){ ... }`

For example:


```r
if (1 &lt; 2) {
  1 + 2
}
```

```
## [1] 3
```

---

## Adding else statements
In a fourth step, we can add a `else { ... }`


```r
if (1 &gt; 2) {
  1 + 2
} else {
  2 + 5
}
```

```
## [1] 7
```

So, the general architecture is like that:

```r
if (condition) {
  function_to_apply(data)
} else {
  other_function_to_apply(data)
}
```

(we could also test for another condition in the else statements with `else if()`)

---

## Translation of joke into R


```r
eggs_available &lt;- TRUE

if (isTRUE(eggs_available)) {
  milk_bought(n_bottles = 12)
} else {
  milk_bought(n_bottles = 1)
}
```

```
## [1] "I have bought 12 bottles of milk"
```


```r
eggs_available &lt;- FALSE

if (isTRUE(eggs_available)) {
  milk_bought(n_bottles = 12)
} else {
  milk_bought(n_bottles = 1)
}
```

```
## [1] "I have bought 1 bottles of milk"
```

---

## Extending our function to be able to speak proper english


```r
milk_bought_2 &lt;- function (n_bottles) {
  if (n_bottles &lt; 2) {
    our_string &lt;-
      paste0("I have bought ", n_bottles, " bottle of milk")
  } else {
    our_string &lt;-
      paste0("I have bought ", n_bottles, " bottles of milk")
  }
  
  our_string
}
```

---

## Now, that's better, right?

```r
eggs_available &lt;- FALSE

if (isTRUE(eggs_available)) {
  milk_bought_2(n_bottles = 12)
} else {
  milk_bought_2(n_bottles = 1)
}
```

```
## [1] "I have bought 1 bottle of milk"
```

---

## ifelse() shortcut
There's also a shorcut using the function `ifelse` when the operations applied to the data
are not too complex (or at least embedded in another function as in our case):



```r
ifelse(
  isTRUE(eggs_available),         # condition
  milk_bought_2(n_bottles = 12),  # if condition is true
  milk_bought_2(n_bottles = 1)    # else if condition is false
)
```

```
## [1] "I have bought 1 bottle of milk"
```

But be aware that `if()` and `ifelse()` were designed for different purposes and the latter is not always a shortcut

---

## And now blend it all together: function in a function
.tinyish[

```r
milk_bought&lt;- function (who, n_bottles, eggs_available) {
  
  # get the right grammar for the right person
  buyer &lt;-
    ifelse(
      who == "I",
      "I have ",
      paste0(who, " has ")
    )
  
  # basic milk buying function
  buy_milk &lt;- function (n_bottles) {
      ifelse(
        n_bottles &lt; 2,
        paste0(buyer, "bought ", n_bottles, " bottle of milk"),
        paste0(buyer, "bought ", n_bottles, " bottles of milk")
      )
  }
  
  # apply the basic milk buying function
  our_string &lt;-
    ifelse(
      isTRUE(eggs_available),
      buy_milk(n_bottles = 12),
      buy_milk(n_bottles = 1)
    )
  
  # get the results
  our_string
}
```
]

---

## The result


```r
milk_bought(who = "I", n_bottles = 12, eggs_available = TRUE)
```

```
## [1] "I have bought 12 bottles of milk"
```

```r
milk_bought(who = "Johannes", n_bottles = 12, eggs_available = FALSE)
```

```
## [1] "Johannes has bought 1 bottle of milk"
```

---

## for () loops
In my opinion, for loops are some of the most useful tools in functional programming.

They enable iterating through input data and applying functions to each element of the data
- it depends on specific purpose what defines this element
- thus, it is important to think about the iterator of the for call

---

## Architecture of for loops


```r
for (iterators in data) {
  function_to_apply(iterator_name)
}
```

So if we had data about a whole programmer gang buying milk but who experience varying availibity of eggs, we could apply our function to each one of them

---

## Building some data


```r
library(randomNames)

our_data &lt;-
  tibble(
    who = randomNames(n = 10, which.names = "first"),
    eggs_available = sample(c(TRUE, FALSE), 10, replace = TRUE)
  )

our_data
```

```
## # A tibble: 10 x 2
##    who          eggs_available
##    &lt;chr&gt;        &lt;lgl&gt;         
##  1 Benjamin     FALSE         
##  2 Chantel      TRUE          
##  3 Brendin      FALSE         
##  4 Azeema       FALSE         
##  5 Jacob        TRUE          
##  6 Abdul Wadood TRUE          
##  7 Garret       TRUE          
##  8 Umair        TRUE          
##  9 Kaitlyn      FALSE         
## 10 Xia          FALSE
```

---


```r
for (row_number in 1:nrow(our_data)) {
  for_output &lt;- 
    milk_bought(
      who = our_data$who[row_number], 
      n_bottles = 12, 
      eggs_available = our_data$eggs_available[row_number]
    )
  
  print(for_output) # output must be printed
}
```

```
## [1] "Benjamin has bought 1 bottle of milk"
## [1] "Chantel has bought 12 bottles of milk"
## [1] "Brendin has bought 1 bottle of milk"
## [1] "Azeema has bought 1 bottle of milk"
## [1] "Jacob has bought 12 bottles of milk"
## [1] "Abdul Wadood has bought 12 bottles of milk"
## [1] "Garret has bought 12 bottles of milk"
## [1] "Umair has bought 12 bottles of milk"
## [1] "Kaitlyn has bought 1 bottle of milk"
## [1] "Xia has bought 1 bottle of milk"
```

---

&gt; The next day, the same programmer's roommate calls him to ask where he is. "I'm back at the grocery," says the programmer. "While you're there, pick up some bread. Thanks!" says the roommate. The programmer never comes home.

---

## Don't try this at home


```r
there &lt;- "Still there"
while (there == "Still there") {
  print("Yeah, there's some bread to pick up right here in the grocery store")
}
```

This runs into an infinite loop, which is the joke is all about. 

---

## Better try this one
Yet, this infinite loop would also require that bread is infinitive
- This is unrealistic
- So we may want to add a bread counter that can reach a minimum


```r
still_there &lt;- TRUE
bread_counter &lt;- 10
while (still_there) {
  print("Yeah, there's some bread to pick up right here in the grocery store.")
  
  bread_counter &lt;- bread_counter - 1
  
  if (bread_counter &lt; 1) { stop("Bread is empty, going home.")}
}
```

---


## Ok, let's take a breath for a while

**First of all: We're not finished yet (sorry!), but are there any intermediate
questions?**

What have we learned so far?
- R a is a proper programming language supporting a lot of data types and a multitude of functions
- You can build your own functions and even nest them
- If-else-statements enable creating algorithms
- for-loops can be used to iterate through data
- while-loops are also useful for algorithms that should stop after a certain point is reached

What's left?
- Some vecotrizations that make life easier: the apply family
- Tidverse looping with purrr


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
