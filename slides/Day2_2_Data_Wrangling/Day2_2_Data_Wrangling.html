<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introduction to R for Data Analysis</title>
    <meta charset="utf-8" />
    <meta name="author" content="Johannes Breuer Stefan JÃ¼nger" />
    <meta name="date" content="2020-08-04" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
    <link href="libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view/tile-view.js"></script>
    <link rel="stylesheet" href="..\workshop.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Introduction to R for Data Analysis
## Data Wrangling
### Johannes Breuer<br />Stefan JÃ¼nger
### 2020-08-04

---

layout: true



&lt;div class="my-footer"&gt;
  &lt;div style="float: left;"&gt;&lt;span&gt;Johannes Breuer, Stefan JÃ¼nger&lt;/span&gt;&lt;/div&gt;
  &lt;div style="float: right;"&gt;&lt;span&gt;GESIS Summer School in Survey Methodology, 2020-08-04&lt;/span&gt;&lt;/div&gt;
  &lt;div style="text-align: center;"&gt;&lt;span&gt;Data Wrangling&lt;/span&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;style type="text/css"&gt;

pre {
  font-size: 10px
}
&lt;/style&gt;

---

# Data wrangling ðŸ¤ 

Data wrangling is the process of "getting the data into shape", so that you can then explore and analyze them.

Common data wrangling steps when working with tabular data in the social &amp; behavioral sciences include:
- renaming variables
- identifying and (re-)coding missing values
- recoding variables/values
- computing new variables
- reducing a dataset by selecting a subset of variables and/or cases

---

# Data wrangling ðŸ¤ 

.large[The (in)famous **80/20-rule**: 80% wrangling, 20% analysis]&lt;sup&gt;1&lt;/sup&gt;  
  
&gt; Given almost every data task, youâ€™ll almost certainly need to .highlight[clean your data, visualize it, and do some exploratory data analysis] Moreover, .highlight[they are also important as you move into more advanced topics.] Do you want to start doing machine learning, artificial intelligence, and deep learning? You had better know how to clean and explore a dataset. If you canâ€™t, youâ€™ll basically be lost ([Sharp Sight Labs, 2017](https://www.sharpsightlabs.com/blog/first-step-data-science-top-performer/)).

.footnote[
[1] Of course, this ratio relates to the time the working time of the analyst, not computing time.
]  

---

# `Base R` vs. `tidyverse`

While data wrangling can be done with `base R`, packages from the [`tidyverse`](https://www.tidyverse.org/) can facilitate this process, especially for `R` novices.

Similar to other fierce academic debates over, e.g., `R` vs. `Python` or Frequentism vs. Bayesianism, people have argued [for](http://varianceexplained.org/r/teach-tidyverse/) and [against](https://blog.ephorie.de/why-i-dont-use-the-tidyverse) using/teaching the `tidyverse`.

Our personal experience with teaching the `tidyverse` is something like this...

.center[&lt;img src="./pics/tidyverse_meme.png" width="50%"&gt;]
&lt;small&gt;&lt;small&gt;Source: https://s.unhb.de/ReoyN&lt;/small&gt;&lt;/small&gt;

---

# `data.table`

Another option for data wrangling with `R` is the [`data.table` package](https://rdatatable.gitlab.io/data.table/index.html). The reason we do not discuss `data.table` in this course is that neither of us has extensive experience with it and comparing all three options (`base R`, `tidyverse`, and `data.table`) side-by-side would be enough for a separate workshop/course.

There is, however, a very detailed [blog post by Jason Mercer](https://wetlandscapes.com/blog/a-comparison-of-r-dialects/) that compares the functionalities of `base R`, `tidyverse`, and `data.table` for data wrangling and [another one by Atreba](https://atrebas.github.io/post/2019-03-03-datatable-dplyr/) that focuses on a comparison between `data.table` and [`dplyr`](https://dplyr.tidyverse.org/) which is a key package for data manipulation from the `tidyverse`. 

---

# Structure &amp; focus of this session

For most of the data wrangling tasks we discuss in this section, we will show how do do them with `base R` and the `tidyverse`, so that you can get a sense of the differences.

Our main focus, however, will be on the use of packages (and functions) from the `tidyverse` and how they can be used to clean and transform your data.

---

# What is the `tidyverse`?

&gt; The `tidyverse` is an .highlight[opinionated collection of R packages designed for data science]. All packages share an .highlight[underlying design philosophy, grammar, and data structures] ([Tidyverse website](https://www.tidyverse.org/)).

&gt; The `tidyverse` is a .highlight[coherent system of packages for data manipulation, exploration and visualization] that share a .highlight[common design philosophy] ([Rickert, 2017](https://rviews.rstudio.com/2017/06/08/what-is-the-tidyverse/)).


```r
include_graphics("./pics/hex-tidyverse.png")
```

&lt;img src="./pics/hex-tidyverse.png" width="25%" style="display: block; margin: auto;" /&gt;

---

# Benefits of the `tidyverse`

As stated before, data wrangling can also be done with `base R`. However, the syntax for this is typically (more) verbose and not intuitive and, hence, difficult to learn, remember, and read (plus many `tidyverse` operations are faster than their `base R` equivalents).  
  
`Tidyverse` syntax is designed to increase **human-readability**. This makes it especially **attractive for R novices** as it can facilitate the experience of **self-efficacy** (see [Robinson, 2017](http://varianceexplained.org/r/teach-tidyverse/)). The `tidyverse` also aims for **consistency** (e.g., data frame as first argument and output) and uses **smarter defaults** (e.g., no partial matching of data frame and column names).]

---

# `tidyverse` vocabulary 101

While there is much more to the `tidyverse` than this, three important concepts that you need to be familiar with, if you want to use it, are:

1. pipes

2. tibbles

3. tidy data

---

# What is a pipe?

&lt;img src="./pics/pipe_office_decoration.jpg" width="40%" style="display: block; margin: auto;" /&gt;
.center[&lt;small&gt;&lt;small&gt;Source: Johannes' office &lt;/small&gt;&lt;/small&gt;]

--

You might know pipes from other scripting utilities 
- e.g., `bash` where a `|` operator is used

---

# What is a pipe?

Put briefly, the pipe operator `%&gt;%` takes an object (which can be the outcome of a previous function) and pipes it (by default as the first argument) into the next function. 

We'll show how to use the pipes and how it compares to `base R` code in the following, but what may already be interesting to know is that *RStudio* has a keyboard shortcut for the the pipe operator `%&gt;%`: &lt;kbd&gt;Ctrl + Shift + M&lt;/kbd&gt; (*Windows* &amp; *Linux*)/&lt;kbd&gt;Cmd + Shift + M&lt;/kbd&gt; (*Mac*)

---

# Nested code in `base R`

If, for example, we wanted to calculate the mean of the mileage per gallon (`mpg`) of the cars in the `mtcars` dataset included as an example in the `readr` package, the `base R` code could look like this:


```r
mean(read_csv(readr_example("mtcars.csv"))$mpg)
```

```
## [1] 20.09062
```

Essentially, the code has to be read from the inside out. Of course, you can also always create new/intermediary objects as in the following example. However, this quickly fills up your workspace and can, eventually, slow down your computer (remember that the objects in the workspace are stored in your computer's working memory.)


```r
example_file        &lt;- readr_example("mtcars.csv")
example_file_loaded &lt;- read_csv(example_file)
mean(example_file_loaded$mpg)
```

```
## [1] 20.09062
```

---

# Pipes to the rescue!

Pipes disentangle the whole process with an alternative approach by applying any involved function step by step:


```r
"mtcars.csv" %&gt;% 
  readr_example() %&gt;% 
  read_csv() %&gt;% 
  .$mpg %&gt;% 
  mean()
```

```
## [1] 20.09062
```

Here the code can be read from top to bottom and you can think of the pipe operator `%&gt;%` as meaning "and then...".

*Note*: The `.` before `$mpg` in the above code example is a placeholder for the output of the previous step. This is useful if this output is not the first argument of a following function. The example is also somewhat unusual in another regard as it starts with a text string. More commonly, pipes start with dataframes.

---

# Types of pipes

While `%&gt;%` is the most widely used pipe operator in the `tidyverse`, there are other types of pipes. These are included in the [`magrittr` package](https://magrittr.tidyverse.org/).

A useful one is the assignment pipe `%&lt;&gt;%` which assigns the outcome of a pipe to the object that serves as input at the beginning of the pipe.

However, for the sake of readability, and because it allows to give the output object a different name, it is usually better to use the regular `R` assignment operator `&lt;-`, even though this means a little more typing (as you have to type the name of the input and the resulting output object, which may be the same.

---

# tibbles

Tibbles are the data format used in the `tidyverse`.

--

They are basically standard `R data.frame()`s, enriched with some more features and metadata:

--

- information about dimensions (rows x columns) of dataframes

--

- information about variable types

--

- better readability
  - they are printed in a way that fits the screen/window

--

Tibbles come with the [`tibbles` package](https://tibble.tidyverse.org/) and it is easy to convert a `data.frame` to a `tibble` (with `as_tibble(data.frame)`) and vice versa (using `as.data.frame(tibble)`.

---

# Tidy data

The 3 rules of tidy data:

1. Each **variable** is in a separate **column**.

2. Each **observation** is in a separate **row**.

3. Each **value** is in a separate **cell**.

&lt;img src="pics/tidy_data.png" width="100%"&gt;
Source: https://r4ds.had.co.nz/tidy-data.html

*NB*: In the `tidyverse` terminology 'tidy data' often also means data in long format - where applicable. 

---

# Wide vs. long format

&lt;img src="pics/wide-long.png" width="90%"&gt;
Source: https://github.com/gadenbuie/tidyexplain#tidy-data

---

# Dataset

In the examples and exercises for this session and the following session, we will use the [Public Use File (PUF) of the GESIS Panel Special Survey on the Coronavirus SARS-CoV-2 Outbreak in Germany](https://www.gesis.org/gesis-panel/coronavirus-outbreak/public-use-file-puf). You can [download the dataset in different formats as well as the codebook and the questionnaire (in German) from the *GESIS* Data Archive](https://search.gesis.org/research_data/ZA5667) (note: you need to have/create a user account).

In order to code along and to be able to do the exercises, you should store the files in a folder called `data` that is in the same folder as the other materials for this course.

You can find more information about the *GESIS Panel* and its methodology on the [*GESIS Panel* website](https://www.gesis.org/en/gesis-panel/gesis-panel-home).

---

# Codebook

It is always advisable to consult the codebook (if there is one) before starting to work with a(n existing) dataset. The *GESIS Panel Special Survey on the Coronavirus SARS-CoV-2 Outbreak in Germany* comes with a very [detailed codebook](https://dbk.gesis.org/dbksearch/download.asp?id=67378).

Side note: If you want to generate a codebook for your own dataset, there are several options in `R`:

- The [`codebook` package](https://github.com/rubenarslan/codebook) which includes an *RStudio*-Addin and also offers a [web app](https://rubenarslan.ocpu.io/codebook/www/)

- the `makeCodebook()` function from the [`dataMaid` package](https://github.com/ekstroem/dataMaid) (see this [blog post](http://sandsynligvis.dk/articles/18/codebook.html) for a short tutorial)

- the `codebook()` function from the [`memisc` package](https://github.com/melff/memisc)

---

# Load the data

The first step, of course, is loading the data into `R`. The *Public Use File (PUF) of the GESIS Panel Special Survey on the Coronavirus SARS-CoV-2 Outbreak in Germany* is available in different formats. We will work with the `.csv` file.


```r
gesis_panel_corona &lt;- read_csv2("./data/ZA5667_v1-1-0.csv")
```


```
## Using ',' as decimal and '.' as grouping mark. Use read_delim() for more control.
```

```
## Parsed with column specification:
## cols(
##   .default = col_double(),
##   za_number = col_character(),
##   version = col_character(),
##   doi = col_character()
## )
```

```
## See spec(...) for full column specifications.
```
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
